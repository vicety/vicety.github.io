

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/vicety/Images@master/images/momiji-ico.ico">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/vicety/Images@master/images/momiji-ico.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="vicety">
  <meta name="keywords" content="">
  
    <meta name="description" content="PID&#x3D;88775351 本节基于Reference 1进行记录 MVCC的设计初衷是读写间不需要隔离 DBMS with MVCC会为一个逻辑对象维护多个物理版本，当txn写入对象，DBMS创建对象的一个新版本，当txn读取对象，DBMS读取txn开始前对象的最新版本。 引入MVCC需要在数据表中额外增加几个字段（版本ID、开始时间、结束时间），需要维护当前活跃的txn序号（时间戳）">
<meta property="og:type" content="article">
<meta property="og:title" content="MVCC">
<meta property="og:url" content="https://vicety.github.io/2021/07/16/MVCC/index.html">
<meta property="og:site_name" content="vicety的博客">
<meta property="og:description" content="PID&#x3D;88775351 本节基于Reference 1进行记录 MVCC的设计初衷是读写间不需要隔离 DBMS with MVCC会为一个逻辑对象维护多个物理版本，当txn写入对象，DBMS创建对象的一个新版本，当txn读取对象，DBMS读取txn开始前对象的最新版本。 引入MVCC需要在数据表中额外增加几个字段（版本ID、开始时间、结束时间），需要维护当前活跃的txn序号（时间戳）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-14-52-59-mvcc-example.png">
<meta property="og:image" content="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-09-16-append-only-storage-mvcc.png">
<meta property="og:image" content="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-54-31-mvcc-time-travel-storage.png">
<meta property="og:image" content="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-59-49-mvcc-delta-storage.png">
<meta property="og:image" content="https://raw.githubusercontent.com/vicety/Images/master/20210712054226.png">
<meta property="article:published_time" content="2021-07-16T01:00:00.000Z">
<meta property="article:modified_time" content="2023-02-09T04:27:58.965Z">
<meta property="article:author" content="vicety">
<meta property="article:tag" content="加密">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-14-52-59-mvcc-example.png">
  
  
  
  <title>MVCC - vicety的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"vicety.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"TdxzU2OpwN7XHsa0T05Y01Kn-gzGzoHsz","app_key":"lfgF4JmupaIQkD5xRHAIBfTk","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 90vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>vicety的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/vicety/Images/master/88775351_p0.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MVCC"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-07-16 03:00" pubdate>
          2021年7月16日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          26 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MVCC</h1>
            
            
              <div class="markdown-body">
                
                <p>PID&#x3D;88775351</p>
<p>本节基于Reference 1进行记录</p>
<p>MVCC的设计初衷是<strong>读写间不需要隔离</strong></p>
<p>DBMS with MVCC会为一个逻辑对象维护多个物理版本，当txn写入对象，DBMS创建对象的一个新版本，当txn读取对象，DBMS读取txn开始前对象的最新版本。</p>
<p>引入MVCC需要在数据表中额外增加几个字段（版本ID、开始时间、结束时间），需要维护当前活跃的txn序号（时间戳）</p>
<p><img src="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-14-52-59-mvcc-example.png" srcset="/img/loading.gif" lazyload><br>（图中使用2pl作为并发控制协议，因此W2A与W1A冲突，需要等待）</p>
<p>数据库系统引入MVCC时需要考虑如下四个部分的设计，稍后会详细介绍：</p>
<ol>
<li>并发控制协议（两段锁、timestamp ordering、OOC）</li>
<li>版本存储</li>
<li>GC</li>
<li>索引管理</li>
</ol>
<h2 id="版本存储"><a href="#版本存储" class="headerlink" title="版本存储"></a>版本存储</h2><p>record中存在一个指针列，用于指向此记录的版本链表，PK索引总是指向链表表头，利用这个链表，DBMS能够找到对于特定txn，这一记录的可见版本</p>
<p>版本存储有三种方案</p>
<h3 id="Append-Only-Storage"><a href="#Append-Only-Storage" class="headerlink" title="Append-Only Storage"></a>Append-Only Storage</h3><p>也是Postgre采用的方案，main table新增一列存储指针，新的版本作为一条记录插入main table。当发生更新时，插入一条新的记录，更新次新记录的链表指针，修改索引（optional）<br><img src="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-09-16-append-only-storage-mvcc.png" srcset="/img/loading.gif" lazyload></p>
<p>关于链表新到旧还是旧到新：</p>
<ol>
<li>O2N，旧到新：查询需要O(N)（为啥不能额外维护一个指向最新版本的指针？），每次GC移除旧值时需要更新索引</li>
<li>N2O，新到旧：每次更新需要更新索引、查询O(1)</li>
</ol>
<h3 id="Time-Travel-Storage"><a href="#Time-Travel-Storage" class="headerlink" title="Time-Travel Storage"></a>Time-Travel Storage</h3><p>在main table增加一列，此外维护一个time-travel table，在其中存储所有旧值与其链表关系。当发生更新时，将main table中的这条记录拷贝到time-travel table，更新time-travel table的链表，在main table写入新值，更新main table的指针列</p>
<p><img src="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-54-31-mvcc-time-travel-storage.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="Delta-Storage"><a href="#Delta-Storage" class="headerlink" title="Delta Storage"></a>Delta Storage</h3><p>也是Mysql与Oracle采用的方案，main table增加一列作为指针，此外维护一个Delta Storage Table。当发生更新时，只拷贝那些发生修改的字段至Delta表，修改Delta表指针，随后在main table修改为新值，修改main table的指针</p>
<p><img src="https://raw.githubusercontent.com/vicety/Images/master/2021-06-28-17-59-49-mvcc-delta-storage.png" srcset="/img/loading.gif" lazyload></p>
<p>delta storage的优势在于不需要拷贝整个记录，劣势在于查询旧版本时需要沿着链表一步步还原，因此相对于Append-Only而言写快读慢</p>
<h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><p>那些没有任何txn能够看见的版本、以及哪些abort的版本可以被回收。在设计回收算法时需要考虑两个问题：</p>
<ol>
<li>如何确定一个版本已经expire</li>
<li>如何决定何时safe to回收内存</li>
</ol>
<p>（然而课程并没有深入介绍）</p>
<h3 id="Tuple-level-Garbage-Collection"><a href="#Tuple-level-Garbage-Collection" class="headerlink" title="Tuple-level Garbage Collection"></a>Tuple-level Garbage Collection</h3><p>通过扫描每条记录，确认这些记录是否已经过期</p>
<h4 id="Background-Vacuuming"><a href="#Background-Vacuuming" class="headerlink" title="Background Vacuuming"></a>Background Vacuuming</h4><p>后台线程定期扫表清理，一个优化是使用bitmap表示整个数据库的所有页面，上次scan以来修改过的页面置位，扫表时只需要关心这些置位的页面，清理后复位</p>
<h4 id="Cooperative-Cleaning"><a href="#Cooperative-Cleaning" class="headerlink" title="Cooperative Cleaning"></a>Cooperative Cleaning</h4><p>Only works for O2N，执行txn的线程，当它们从旧timestamp开始遍历时，能够知道哪些timestamp已经不能被其他thread seen，因此顺便执行gc操作，如果是N2O，那么txn在从New拿当前数据之外，还需要额外遍历到Old去GC，效率上不如O2N</p>
<h3 id="Transaction-level-Garbage-Collection"><a href="#Transaction-level-Garbage-Collection" class="headerlink" title="Transaction-level Garbage Collection"></a>Transaction-level Garbage Collection</h3><p>没有做深入介绍，大致的意思是每个txn维护自己的old value集合，当提交&#x2F;回滚后，gc器能够据此决定是否回收这些记录</p>
<h2 id="Index-Management"><a href="#Index-Management" class="headerlink" title="Index Management"></a>Index Management</h2><p>对于索引列，每当更新导致产生新的版本时，为了确保old timestamp的查询仍然能走索引，不能更新旧值的索引直到垃圾回收，对于新值，需要先将旧值在当前timestamp标记为删除，然后重新插入一条数据，这样就产生了两条version chain</p>
<p>对于二级索引（Append Only为例），坏的做法（Postgres的做法）是索引存最新记录的位置，当列更新时，每个索引的指向都要更新，两种优化：</p>
<ol>
<li>（MySQL的做法）二级索引指向一级索引，更新时只更新一级索引</li>
<li>创建一个中间层，比如说维护一个map，key是行ID，value是物理地址，二级索引指向map的key，即tuple ID，其实和方法一一样</li>
</ol>
<p>下面是对于各种类型数据库使用的并发控制协议、MVCC版本存储方式、MVCC GC方式、二级索引是否是逻辑的<br><img src="https://raw.githubusercontent.com/vicety/Images/master/20210712054226.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="InnoDB的实现"><a href="#InnoDB的实现" class="headerlink" title="InnoDB的实现"></a>InnoDB的实现</h2><p>可能是本文中最贴近面试的一个话题了</p>
<p>参考了知乎上Reference 2的内容，大量复制粘贴+少量总结预警</p>
<p>Innodb MVCC实现的核心知识点</p>
<ol>
<li>事务版本号<br>每次事务开启前都会从数据库获得一个自增长的事务ID，可以从事务ID判断事务的执行先后顺序。</li>
<li>表的隐藏列：当前行最新一次修改的事务ID、指向上一版本数据的undo log指针、如果没有聚集索引，会有隐藏的列作为聚集索引</li>
<li>undo log<br>undo log中也维护了指向更早修改此值的undo log的指针</li>
<li>read view<br>在每次select&#x2F;每次开启事务（取决于隔离登记，RC或RR）时都会得到一个read view，read view中维护了trx_ids: 当前未提交事务集合（包含creator_trx_id）、low_limit_id: 创建read view时DB的最大事务号+1、up_limit_id: 当前未提交事务的最小版本号、creator_trx_id: 当前事务版本号</li>
</ol>
<p>执行select时，按照read_view中的一下信息选择展示数据内容：</p>
<ol>
<li>如果数据事务ID小于up_limit_id（所有活跃事务ID），必定已提交，可以展示</li>
<li>数据事务ID大于等于low_limit_id（创建view时DB最大tx ID），必定是view创建后产生的变动，不展示</li>
<li>小于low_limit_id，大于等于up_limit_id<ol>
<li>如果数据事务ID已提交（不存在于trx_ids），可以展示</li>
<li>如果数据事务ID等于creator_trx_id，自己修改的数据当然能够看见</li>
<li>如果数据事务ID在trx_ids中，不展示</li>
</ol>
</li>
</ol>
<p>Question: 如何定义 MVCC 下的不同事务产生冲突（因此无法都 commit）？</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Optimistic_concurrency_control">https://en.wikipedia.org/wiki/Optimistic_concurrency_control</a><br>Check whether other transactions have modified data that this transaction has used (read or written). This includes transactions that completed after this transaction’s start time, and optionally, transactions that are still active at validation time.</p>
</blockquote>
<h2 id="自言自语"><a href="#自言自语" class="headerlink" title="自言自语"></a>自言自语</h2><p>根据Reference 3，RC可以通过MVCC实现，我猜RC仍然需要读过去版本的原因是steal策略会写未提交到磁盘，这种情况下需要undo来获得已提交值</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=E4u4ogqfEIA&list=PLSE8ODhjZXjbohkNBWQs_otTrBTrjyohi&index=19">19 - Multi-Version Concurrency Control (CMU Databases Systems &#x2F; Fall 2019)</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/52977862">InnoDB MVCC实现</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/298576970">MVCC &amp; SI: Protocol</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%8A%80%E6%9C%AF/" class="category-chain-item">技术</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%8A%A0%E5%AF%86/">#加密</a>
      
        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">#数据库</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MVCC</div>
      <div>https://vicety.github.io/2021/07/16/MVCC/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>vicety</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年7月16日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/07/16/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/" title="数据库之并发控制">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">数据库之并发控制</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/07/16/%E6%81%A2%E5%A4%8D%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86/" title="恢复系统与缓冲区管理">
                        <span class="hidden-mobile">恢复系统与缓冲区管理</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"p7Skzx1UifgNosmr5ms2nILv-gzGzoHsz","appKey":"W73NSV1s3dRPtfceJDBsX5uP","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
